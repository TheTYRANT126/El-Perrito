<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>El Perrito — Mi cuenta</title>
    <link rel="stylesheet" href="../src/css/main.css">
</head>

<body class="bg">
    <header class="header">
        <a href="../index.html"><img class="logo" src="../src/assets/logo.png" alt="El Perrito"></a>
        <nav class="nav">
            <a href="../index.html">Inicio</a>
            <a href="cart.html">Carrito</a>
            <a id="accountLink" href="login.html">Cuenta</a>
        </nav>
    </header>

    <div class="container">
        <h1 style="color:#2c5db5; font-size:48px; margin:0 0 12px 0">Mi cuenta</h1>
        <div class="account-grid">
            <a class="tile" href="#" id="tile-history">Historial de compras</a>
            <a class="tile" href="#" id="tile-cards">Tarjetas</a>
            <a class="tile" href="#" id="tile-address">Dirección de envío</a>
            <a class="tile" href="#" id="tile-profile">Cambiar datos</a>
            <a class="tile" href="#" id="tile-delete">Eliminar cuenta</a>
            <a class="tile" href="#" id="tile-logout">Cerrar Sesión</a>
        </div>
    </div>

    <!-- Modal de Historial de Compras -->
    <div id="modal-history" class="modal" style="display:none">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Historial de Compras</h2>
                <span class="modal-close" data-modal="modal-history">&times;</span>
            </div>
            <div class="modal-body">
                <div id="history-list">
                    <p style="text-align:center; color:#999">Cargando...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Detalle de Compra -->
    <div id="modal-order-detail" class="modal" style="display:none">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Detalle de Compra</h2>
                <span class="modal-close" data-modal="modal-order-detail">&times;</span>
            </div>
            <div class="modal-body">
                <div id="order-detail-info"></div>
                <div id="order-detail-items" style="margin-top:20px"></div>
                <div id="order-cancel-section" style="margin-top:20px; text-align:center; display:none">
                    <button class="btn danger" id="btn-cancel-order">Cancelar Pedido</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Direcciones de Envío -->
    <div id="modal-address" class="modal" style="display:none">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Mis Direcciones de Envío</h2>
                <span class="modal-close" data-modal="modal-address">&times;</span>
            </div>
            <div class="modal-body">
                <button class="btn success" id="btn-add-address" style="margin-bottom:20px">+ Agregar Nueva Dirección</button>
                <div id="address-list">
                    <p style="text-align:center; color:#999">Cargando...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar/Editar Dirección -->
    <div id="modal-address-form" class="modal" style="display:none">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="address-form-title">Nueva Dirección</h2>
                <span class="modal-close" data-modal="modal-address-form">&times;</span>
            </div>
            <div class="modal-body">
                <form id="form-address">
                    <input type="hidden" id="input-id-direccion" name="id_direccion">

                    <div class="form-group">
                        <label for="input-nombre-completo">Nombre completo del destinatario *</label>
                        <input type="text" id="input-nombre-completo" name="nombre_completo" required>
                    </div>

                    <div class="form-group">
                        <label for="input-telefono">Teléfono *</label>
                        <input type="tel" id="input-telefono" name="telefono" required>
                    </div>

                    <div style="display:grid; grid-template-columns:2fr 1fr 1fr; gap:12px">
                        <div class="form-group">
                            <label for="input-calle">Calle *</label>
                            <input type="text" id="input-calle" name="calle" required>
                        </div>
                        <div class="form-group">
                            <label for="input-num-ext">Núm. Ext</label>
                            <input type="text" id="input-num-ext" name="numero_exterior">
                        </div>
                        <div class="form-group">
                            <label for="input-num-int">Núm. Int</label>
                            <input type="text" id="input-num-int" name="numero_interior">
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="input-colonia">Colonia *</label>
                        <input type="text" id="input-colonia" name="colonia" required>
                    </div>

                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
                        <div class="form-group">
                            <label for="input-ciudad">Ciudad *</label>
                            <input type="text" id="input-ciudad" name="ciudad" required>
                        </div>
                        <div class="form-group">
                            <label for="input-estado">Estado *</label>
                            <input type="text" id="input-estado" name="estado" required>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="input-cp">Código Postal *</label>
                        <input type="text" id="input-cp" name="codigo_postal" maxlength="5" required>
                    </div>

                    <div class="form-group">
                        <label for="input-referencias">Referencias (opcional)</label>
                        <textarea id="input-referencias" name="referencias" rows="3" style="width:100%; padding:12px; border:1px solid var(--border); border-radius:10px"></textarea>
                    </div>

                    <div class="form-group">
                        <label style="display:flex; align-items:center; gap:8px; cursor:pointer">
                            <input type="checkbox" id="input-predeterminada" name="es_predeterminada" value="1">
                            <span>Marcar como dirección predeterminada</span>
                        </label>
                    </div>

                    <button type="submit" class="btn primary" style="width:100%; margin-top:12px">Guardar Dirección</button>
                </form>
                <p id="address-form-message" style="margin-top:12px; text-align:center; display:none"></p>
            </div>
        </div>
    </div>

    <!-- Modal de Tarjetas -->
    <div id="modal-cards" class="modal" style="display:none">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Mis Tarjetas</h2>
                <span class="modal-close" data-modal="modal-cards">&times;</span>
            </div>
            <div class="modal-body">
                <button class="btn success" id="btn-add-card" style="margin-bottom:20px">+ Agregar Nueva Tarjeta</button>
                <div id="card-list">
                    <p style="text-align:center; color:#999">Cargando...</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para Agregar/Editar Tarjeta -->
    <div id="modal-card-form" class="modal" style="display:none">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="card-form-title">Nueva Tarjeta</h2>
                <span class="modal-close" data-modal="modal-card-form">&times;</span>
            </div>
            <div class="modal-body">
                <form id="form-card">
                    <input type="hidden" id="input-id-tarjeta" name="id_tarjeta">

                    <div class="form-group">
                        <label for="input-tipo-tarjeta">Tipo de Tarjeta *</label>
                        <select id="input-tipo-tarjeta" name="tipo_tarjeta" required style="width:100%; padding:12px; border:1px solid var(--border); border-radius:10px">
                            <option value="">Selecciona un tipo</option>
                            <option value="visa">Visa</option>
                            <option value="mastercard">Mastercard</option>
                            <option value="amex">American Express</option>
                            <option value="discover">Discover</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="input-numero-tarjeta">Número de tarjeta *</label>
                        <input type="text" id="input-numero-tarjeta" name="numero_tarjeta" maxlength="19" pattern="\d{13,19}" placeholder="1234567890123456" required>
                        <small style="color:var(--muted)">Ingresa el número completo de tu tarjeta (13-19 dígitos)</small>
                    </div>

                    <div class="form-group">
                        <label for="input-cvv">CVV *</label>
                        <input type="text" id="input-cvv" name="cvv" maxlength="4" pattern="\d{3,4}" placeholder="123" required>
                        <small style="color:var(--muted)">Código de seguridad de 3 o 4 dígitos</small>
                    </div>

                    <div class="form-group">
                        <label for="input-nombre-titular">Nombre del titular *</label>
                        <input type="text" id="input-nombre-titular" name="nombre_titular" placeholder="Nombre como aparece en la tarjeta" required>
                    </div>

                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px">
                        <div class="form-group">
                            <label for="input-mes-expiracion">Mes de Expiración *</label>
                            <select id="input-mes-expiracion" name="mes_expiracion" required style="width:100%; padding:12px; border:1px solid var(--border); border-radius:10px">
                                <option value="">Mes</option>
                                <option value="01">01 - Enero</option>
                                <option value="02">02 - Febrero</option>
                                <option value="03">03 - Marzo</option>
                                <option value="04">04 - Abril</option>
                                <option value="05">05 - Mayo</option>
                                <option value="06">06 - Junio</option>
                                <option value="07">07 - Julio</option>
                                <option value="08">08 - Agosto</option>
                                <option value="09">09 - Septiembre</option>
                                <option value="10">10 - Octubre</option>
                                <option value="11">11 - Noviembre</option>
                                <option value="12">12 - Diciembre</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="input-anio-expiracion">Año de Expiración *</label>
                            <select id="input-anio-expiracion" name="anio_expiracion" required style="width:100%; padding:12px; border:1px solid var(--border); border-radius:10px">
                                <option value="">Año</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label style="display:flex; align-items:center; gap:8px; cursor:pointer">
                            <input type="checkbox" id="input-predeterminada-card" name="es_predeterminada" value="1">
                            <span>Marcar como tarjeta predeterminada</span>
                        </label>
                    </div>

                    <button type="submit" class="btn primary" style="width:100%; margin-top:12px">Guardar Tarjeta</button>
                </form>
                <p id="card-form-message" style="margin-top:12px; text-align:center; display:none"></p>
            </div>
        </div>
    </div>

    <script type="module" src="../src/js/header.js"></script>
    <script src="../src/js/account.js"></script>
    <script src="../src/js/account-cards.js"></script>
</body>

</html>
